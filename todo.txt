
Release 6:

Changelog:

- Battle: Fixed new countries not shown on country selector.
- Battle: Fixed manual unit adding not working.
- Battle: Fixed order of naval units in fast planner.
- Battle: Fixed changing flank size not automatically updating the result.
- Battle: Fixed right-click cohort removal not always working correctly.
- Battle: Fixed cohort tooltip not appearing when moving mouse fast.
- Battle: Fixed total damage shown incorrectly on cohort tooltips (if target had experience).
- Battle: Improved flank size setting to work more accurately (not sure when this was changed).
- Battle: Added support for backrow and backrow effectiveness.
- Battle: Added food consumption and storage to fast planner.
- Battle: Refactored state for armies (first step towards multiarmy battles).
- Stats: Added average gold losses to naval simulations (from repair, from destroyed, from captured, etc.).
- Stats: Added separate settings for calculating different things.
- Countries: Updated Export Hemp to give -10% Naval Damage taken instead of +5% Naval Damage done.
- Countries: Added naval capture chance from general martial (0.2% * martial).
- Countries: Added support for country specific combat width modifiers, feature from EUIV.
- Countries: Added new table at bottom to allow changing country specific attributes.
- Countries: Removed Global and General words from modifier targets (should be obvious without them.)
- Countries: Refactored general to be separate entity (second step towards multiarmy battles).
- Units: Updated balance changes from 1.3.2 (War Elephants damage against Infantry, Supply Train cost).
- Units: Updated 1 maneuver to Mega-Polyreme (no idea when this was changed).
- Units: Fixed order of naval units.
- Units: Fixed unit renaming not working (also fixed terrain and tactic renaming).
- Units: Improved maintenance costs (higher accuracy).
- Units: Added new attributes: food consumption and storage.
- Units: Added new attributes: capture chance and capture resist.
- Units: Added a new attribute for reducing daily morale losses, feature from EUIV.
- Units: Added new attributes for Fire and Shock phases (base + modifier), feature from EUIV.
- Units: Added support for changing the base type of a unit (allows more flexible unit hierarchies, for EUIV).
- Units: Removed support for changing unit mode (land or naval), instead it is derived from the base unit.
- Units: Removed support for global unit mode (units are now either land or naval units).
- Units: Removed can assault toggle button (attribute not used anywhere in simulator).
- Units: Refactored base stats to a base unit (simplifies code and allows using it as a neutral unit).
- Settings: Improve page layout which more clearly shows which settings affects land, naval or both.
- Settings: Improved settings for bug fixes (and some others), converted to checkbox settings.
- Settings: Improved names and descriptions for all settings.
- Settings: Updated a 20% increase to base damage values.
- Settings: Removed "Fix damage taken" setting as it is fixed in the game.
- Settings: Updated Defender's advantage to be disabled by default (people seem to make wrong conclusions because of it).
- Settings: Added a new setting to enable backrow (support units are prioritized), feature from EUIV.
- Settings: Added a new setting for discipline reducing damage, feature from EUIV.
- Settings: Added a new setting for daily morale losses, feature from EUIV.
- Settings: Added a new setting for enabling fire and shock phases, feature from EUIV.

Todo:
 - Transfer could only show non-base stats for units, terrains and tactics (since base stats are supposed to regenerate?), currently it shows way too much information.
 - Refactor simluation to update only single parameter, also parameters split should make more sense
 - Some sort of place for business logic rules

Tags:
 - Icons to frontline to show various things, with tooltips:
  * Defender's advantage (some kind of ninja icon?) - This is expected to be fixed so shouldn't waste time.
  * Very bad matchup, bad match up, good matchup, very good matchup (red or green arrows)
  * Flanking (attacking without being attacked)
  * No target (red sign)
 - Battle stats to show amount of tags acquired (hopefully gives a better view of the battle)
 - Battle stats to show individual units

Settings:
 - Better descriptions
 - Show default value
 - Show current change versus default value (for example faster battles, more randomness)
 - New settings for deployment / reinforcement order/attribute.
 - More sections for settings (at least new section for deployment and reinforcement, game mechanics, simulation settings).

EUIV:
 - Tooltip needs to show source of losses (to include daily loss)
 - Military tactics as defensive value (+ setting)
 - Derivate attributes (reduce flanking range based on strength)
 - Cavalry to infantry ratio (flank to front, country definition, + setting)
 - Fire and shock phases, fire/shock damage done/taken attributes (+ setting)
 - Fire, shock and morale pips (+ setting)
 - General fire, shock and maneuver pips (+ setting for pip cap, 0 for disabled)
 - Setting for martial cap (0 for disabled)
 - Units: Available units determined by tech level + culture (selector should sort by tech level + show pips)
 - Units on the backline take full morale casualties
 - Increasing daily multiplier (1% per day)
 - Combat ability directly increases damage
 - General and unit pips affect dice rolls (enemy ones reduce)
 - Base damage is different for each unit (also depends on phase, also different for morale damage)

Tests (high priority):
- utils tested
- check that reinforcement is stable (higher key ends in right position)

Rowtype selectors could show unit priority? Different colors for main and flank. Frontline could slightly color tiles based on main/flank.

Pluralization of reducers, state, etc

Combat things to combat reducer. Perhaps state as parameter when needed? Since it only changes same things as battle reducer,

Stats to show amount of traditions, trade, etc..


Release++:

Reducers can probably be split to sub reducers (one handles the data structure, other the actual data)

Army management:
- Probably needed for multi-army battles because countries need to have multiple armies
- General selector to units page, renamed to army?
- Custom changes for whole country, renamed to country?
- Accordion for general?
- Accordion for reserve?
- Accordion for unit definitions?

- Accordions to more places?? (unit detail?)

Countries:
- Tag selector for tech (some inventions are tag specific)
- Tag preset selector for common tags (selects tradition, tag for tech and religion)

Land battle:
- Deployment order based also on manpower!! (before index), need to to test whether full strength is prioritized for both deploy and reinforce

Multi army:
- Two armies attack: First army on initial deployment on day 0, second army does from bottom to top
- Two armies attack, second one day later: Second army from bottom to top on day 2 (1 day after arrival), two last units of first army get moved to second last and third last spots???
- When an army joins: two lasts units of current army are given low priority, the last unit of the new army is given even lower priority
- If last unit in the current army gets defeated right before new army joins, the move is not done. Move is checked before defeated are removed? Weird logic...

Multi army flanking:
- 20 vs 10 + 10, not happened
- 10 vs 10 + 10, happened. But first unit of second army goes to index 1??
- 10 vs 5 + 5, happened, again first unit goes to index 1...
- Flank size depends on amount of units??
- 8 vs 10 + 10, 5 units on sides, but edges empty, edges filled filled edge to center, center filled from center to edge.
- 8 vs 5 + 5, 5 units on sides, but edges empty
- 6 vs 10 + 10, 5 units on sides
- 9 vs 10 + 10, flank size 10, 5 units on sides, but edges empty
- 8 vs 10 + 10, flank size 10, 7 units on sides, but edges empty
- 7 vs 10 + 10, flank size 10, 10 units on sides, but edges empty
- 6 vs 10 + 10, flank size 10, 10 units on sides, but edges empty
- 2 vs 10 + 10, flank size 10, 5 units on sides
- If units move together, 2 x edges on sides

Findings:
- Preferred flank is first army sets maximum amount of units put on sides (or the bigger army??).
- Sides have 1 x empty, but if armies together then 2 x empty.
- Amount of enemy? units determines flank (10 + 10 own units). 
  - 20 units: 0 flank but weird shifting
  - 10 units: 1 flank
  - 9 units: 5 flank
  - 8 units: 7 flank
  - 7 units: 10 flank (capped)
  - 6 units: 10 flank (capped)
  - 4 units: 10 flank (capped)
  - 3 units: 7 flank
  - 2 units: 5 flank
  - 1 units: 1 flank
  - 1 units + 1 + 5: 5 flank
  - 1 units + 1 + 10: 5 flank
  - 1 units + 1 + 10: 10 flank
  - 1 vs 9 + 10: 5 flank -> no flank, only 9 units deploy, 2 shift to edges
  - 1 vs 9 + 10: 10 flank -> 2 flank
  - 1 vs 9 + 10: 2 flank -> no flank, only 3 units deploy, 2 shift to edges
- Set units to flank, no units deploy!! except with 10 flank

Findings 2:
- 2 reinforcement modes:
  - Flanking: Some units set to edges
  - Non-flanking: Shift, not all (flank?) units deploy
- Flank size may change mode
- Mode seems to be also affected by amount of units in the filled
- Amount of units also affects flank size