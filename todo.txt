
Release 7:

Changelog:
 
 UI:
  - Improved unit definition modal: Information about unit definition and parent unit definition are now shrunk to make the "Explained" column easier to read.
  - Improved navigation: Units, Terrains and Tactics pages merged under Definitions page to indicate that they aren't the primary way to apply modifiers.
  - Added dropdown setting for Discipline (Off, Only damage done, Both damage done and taken).
  - Added new tab for stack wipe settings: On/Off, round limit for "soft" wipe, limits for "soft" and "hard" wipes.
  - Changed default analyze settings to be faster.
  - Added a tooltip to the winrate button and result.
  - Added delays to most tooltips to prevent them flickering when moving mouse.

Combat:
  - Morale and strength no longer go below zero. This fixes slightly inflated losses on Analyze tool.
  - Added checks for different stack wipes (no deploy, 10/1 limit, 2/1 limit on no retreat).
  - Fixed EUIV combat having dice rolls from 1 to 9 instead of from 0 to 9. This doesn't affect combat calculations that much but will slow down Analyze page because of more simulations.

Testing:
  - Added unit tests to verify that most mechanics works as intended.
  - Added unit tests to verify stack wipe mechanics.

Refactor:
  - Invalidate is now done automatically for all non-UI actions. Removes lots of low value code.

TODO:

Tests:
 - Mechanics tested. Create a complex base scenario with all mechanics turned off. Then test turning them on individually. Also the tooltip should be tested to match the result.
  * This verifies that the combat calculations work as intended.
  * This verifies that the mechanics settings work as intended.
  * This verifies that the tooltip matches actual result.

UI:
 - Togglable stats rows to show individual units or hide unit types.
 - Unit tooltip should somehow show sources for losses (to include daily loss from EUIV and damage from different units).
 - Unit type selector should automatically upgrade/downgrade selected unit to a similar unit. Up to 4 choices but with no clear typing. Also remove Latest. + Setting for this.
  * Sometimes units have same offensive/defensive allocation but focuses on different attribute. Sometimes same attribute allocation but different offensive/defensive focus.
  * Seems mostly a problem for Western with so many unit types.
  * One heuristic could be: Count offensive and defensive pips of all stats, and then count offensive/defensive for two biggest stats as tiebreaker.
  * When selecting unit store its primary and secondary type as the selection. When upgrading/downgrading use these types to select the unit.

Countries:
 - Finish converters for relevant information.
 - Remove religion and omens. Simply add Deity of Discipline, etc.
  * Selecting religion is cumbersome and just adds extra maintenance.
 - Inventions to show tag specific (without actually implementing tags).
  * These inventions are extra. Perhaps a 4th slot for toggle? Or just implement scrolling?
 - Heritages should probably also be limited to military ones.




Release++:

Settings:
 - discipline: Reduces damage, only increases damage, no effect.
 - general maneuver: Affects crossing, affects terrain, affects both, no effect.
 - general: martial, fire&shock, both
 - Show on main page current settings set (Imperator, EUIV, mixed), tooltip to show individual (or only changed?)
 - New settings for deployment / reinforcement order/attribute.
 - More sections for settings (at least new section for deployment and reinforcement, game mechanics, simulation settings).

Todo:
 - Transfer could only show non-base stats for units, terrains and tactics (since base stats are supposed to regenerate?), currently it shows way too much information.
 - Refactor simluation to update only single parameter, also parameters split should make more sense
 - Some sort of place for business logic rules
 - Rowtype selectors could show unit priority? Different colors for main and flank. Frontline could slightly color tiles based on main/flank.
 - Combat things to combat reducer. Perhaps state as parameter when needed? Since it only changes same things as battle reducer,
 - Stats to show amount of traditions, trade, etc..
 - Definition functions probably all could mutate (mostly used in reducers?)
 - Winrate could automatically set precision based on unit count (or some other heuristic like timing first batch).
 - A button for random setup

Tests:
- utils tested
- check that reinforcement is stable (higher key ends in right position)

Tags:
 - Icons to frontline to show various things, with tooltips:
  * Defender's advantage (some kind of ninja icon?) - This is expected to be fixed so shouldn't waste time.
  * Very bad matchup, bad match up, good matchup, very good matchup (red or green arrows)
  * Flanking (attacking without being attacked)
  * No target (red sign)
 - Battle stats to show amount of tags acquired (hopefully gives a better view of the battle)

Army management:
- Probably needed for multi-army battles because countries need to have multiple armies
- General selector to units page, renamed to army?
- Custom changes for whole country, renamed to country?
- Accordion for general?
- Accordion for reserve?
- Accordion for unit definitions?

- Accordions to more places?? (unit detail?)

Land battle:
- Deployment order based also on manpower!! (before index), need to to test whether full strength is prioritized for both deploy and reinforce

Combat calculations:
- In the game, integer calculations are used so the result is rounded down after each step.
- This doesn't matter in Imperator because of higher precision but causes manpower to be bit off in EUIV.
- Implementing this slows down the combat a lot because precalculation won't be possible.
- Also the exact order of calculations must be researched or acquired from devs to get accurate results.